<html>

<head>
<script type='text/javascript' src="js/ClassObject.js"></script>
<script type='text/javascript' src="js/DefaultMode.js"></script>
<script type='text/javascript' src="js/SelectMode.js"></script>
<script type='text/javascript' src="js/AddClassMode.js"></script>
<script type='text/javascript' src="js/view.js"></script>
<script type='text/javascript' src="js/UMLEditorModel.js"></script>
</head>

<body id="bdy">
</body>
<script>
/*** Control ***/
// @param model UMLEditorModel
function NewSelectNode(model)
{
    var np = View.CreateSelectNode();
    np.onclick = function()
    {
        model.ClickSelectButton();
    };
    model.UIReflectors.ChangeButtonState
        .ChangeSelectButton = function(active)
    {
        (active?View.ActiveButton:View.InactiveButton)
        (np);
    };
    return np;
}
// @param model UMLEditorModel
function NewAddClassNode(model)
{
    var np = View.CreateAddClassNode();
    np.onclick = function()
    {
        model.ClickAddClassButton();
    };
    model.UIReflectors.ChangeButtonState
        .ChangeAddClassButton = function(active)
    {
        (active?View.ActiveButton:View.InactiveButton)
        (np);
    };
    return np;
}
// @param model UMLEditorModel
function NewAddLineNode(model)
{
    var np = View.CreateAddLineNode();
    np.onclick = function()
    {
        model.ClickAddLineButton();
    };
    model.UIReflectors.ChangeButtonState
        .ChangeAddLineButton = function(active)
    {
        (active?View.ActiveButton:View.InactiveButton)
        (np);
    };
    return np;
}
function NewCanvasNode(model)
{
    var np = View.CreateCanvasNode();
    np.onmousedown = function(e)
    {
        model.MouseDownCanvas(e.offsetX, e.offsetY);
    };
    np.onmouseup = function(e)
    {
        model.MouseUpCanvas(e.offsetX, e.offsetY);
    };
    np.onmousemove = function(e)
    {
        model.MouseMoveCanvas(e.offsetX, e.offsetY);
    };
    return np;
}
bdy.onload = function()
{
    var model = new UMLEditorModel();
    var canvas = NewCanvasNode(model);
    model.Events.OnNewClass = function(_class)
    {
        var class_node = View.CreateClassNode(
            _class.x, _class.y);
        // Model notify View
        _class.UIReflectors.FocusIt = function()
        {
            View.FocusObjectNode(class_node);
        };
        // View notify Model
        class_node.onmousedown = function(e)
        {
            model.MouseDownObject(_class, e.offsetX, e.offsetY);
            e.stopPropagation();
        };
        class_node.onmouseup = function(e)
        {
            model.MouseUpObject(_class, e.offsetX, e.offsetY);
            e.stopPropagation();
        };
        class_node.onmousemove = function(e)
        {
            model.MouseMoveObject(_class, e.offsetX, e.offsetY);
            e.stopPropagation();
        };
        canvas.appendChild(class_node);
    };
    bdy.appendChild(NewSelectNode(model));
    bdy.appendChild(NewAddClassNode(model));
    bdy.appendChild(NewAddLineNode(model));
    bdy.appendChild(canvas);
};

</script>
</html>
